# Configuration personnalisée pour api.beRich.oups.net
# Ce contenu sera inclus dans le bloc 'server' généré par nginx-proxy

# Ajoute les en-têtes CORS pour toutes les réponses (incluant les erreurs)
# '$http_origin' utilise l'origine envoyée par le navigateur
add_header 'Access-Control-Allow-Origin' "$http_origin" always;
add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
# Adaptez les 'Allow-Headers' si votre frontend envoie d'autres en-têtes spécifiques
add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, X-Requested-With' always;
# Important si votre frontend envoie des cookies ou Authorization header
add_header 'Access-Control-Allow-Credentials' 'true' always;
# Mise en cache de la réponse preflight (optionnel mais recommandé)
add_header 'Access-Control-Max-Age' 1728000;

# Gère spécifiquement la requête OPTIONS (preflight)
if ($request_method = 'OPTIONS') {
    # Les en-têtes sont déjà ajoutés par les 'add_header' ci-dessus avec 'always'
    # On retourne simplement un succès '204 No Content'
    return 204;
}

# Note: Pas besoin de 'location / { ... }' ici, nginx-proxy gère le proxy_pass.
# Ces directives s'appliquent à l'ensemble du vhost ou aux locations définies par nginx-proxy.